戦闘システム実装チェックリスト（v1.2）

【全体的なコード現状注釈】:
このチェックリストの多くの項目は、関連する仕様書（`CSV実装仕様.txt`、`ゲーム仕様.txt`）と現行コードの間に大きな差異が見られるか、未実装の状態です。
注釈が追記された仕様書とコードの現状を照らし合わせながら、このチェックリストの各項目の達成状況を再評価する必要があります。
特に、CSVの構造、戦闘計算の詳細（時間、命中、クリティカル、ダメージ）、action_traitの扱い、勝利条件など、コアな部分での食い違いが目立ちます。
以下の各項目には、主要な差異や現状を追記していますが、詳細は各仕様書の注釈も参照してください。

【優先度：最重要】コアシステムの基盤

戦闘を成立させるための最低限のデータと構造。

    [ ] データ管理 (Data Management)
        【コード現状注釈】: CSVファイル構造・内容、データ構造定義が現行コードと大きく異なります。

        [ ] 1. CSVファイルの作成:
            【コード現状注釈】: 仕様書通りの単一 `parts.csv` や指定カラム数の `medals.csv` は作成されていません。

            [ ] a. parts.csv: 「CSV実装仕様.txt」で定義した全16列のCSVを作成する。
                【コード現状注釈】: 未達成。コードは部位別CSV (`head_parts.csv`等) を使用し、カラム構成も仕様と異なります。
            [ ] b. medals.csv: 「CSV実装仕様.txt」で定義した全7列のCSVを作成する。（AIのターゲッティングを後回しにするなら、idとmedal_nameだけでもOK）
                【コード現状注釈】: 未達成。コードが使用する `medals.csv` はカラム構成が仕様と異なります。

        [ ] 2. データ構造の定義 (Go struct):
            【コード現状注釈】: 対応するCSVの前提が異なるため、struct定義も仕様書の想定とは異なります。

            [ ] a. Part構造体: parts.csvの1行に対応するstructを定義。
                【コード現状注釈】: `Part`構造体は存在しますが、部位別CSVを前提としたフィールド構成です。
            [ ] b. Medal構造体: medals.csvの1行に対応するstructを定義。
                【コード現状注釈】: `Medal`構造体は存在しますが、現行の`medals.csv`に合わせたフィールド構成です。

        [ ] 3. CSVローダーの実装:
            【コード現状注釈】: ローダーは存在するものの、読み込むファイルとデータ形式が異なります。

            [ ] a. パーツ読み込み: ゲーム起動時にparts.csvを読み込み、map[string]Partなどの形で全パーツデータを保持する。
                【コード現状注釈】: 部位別CSVを読み込み、`GameData`内のスライスおよびマップに保持。
            [ ] b. メダル読み込み: ゲーム起動時にmedals.csvを読み込み、map[string]Medalなどの形で全メダルデータを保持する。
                【コード現状注釈】: `medals.csv`を読み込み、`GameData`内のスライスに保持。

    [ ] 機体構成 (Robot Structure)

        [ ] 1. Robot構造体の定義: 5つのPartID（頭・両腕・脚・メダル）と、チーム、リーダーフラグ、現在の各部位HPなどを保持する。
            【コード現状注釈】: `Medarot`構造体が該当。パーツは実体ポインタのマップ、メダルも実体ポインタで保持。部位HPは各`Part`構造体内で管理。概ね要求に近いが細部が異なる。
        [ ] 2. 機体生成: パーツIDの組み合わせから、Robotインスタンスを生成する機能。
            【コード現状注釈】: 実装済み (`medarot_initializer.go`)。

【優先度：高】戦闘ロジックの中核

実際の攻防を成立させるための計算ロジック。

    [ ] 戦闘計算式 (Combat Formulas)
        【コード現状注釈】: 仕様書と計算式や前提条件が多くの点で異なります。

        [ ] 1. 時間計算:
            【コード現状注釈】: 仕様書の秒数計算ではなく、ゲージベースで進行。

            [ ] a. チャージ時間: 500 / (充填 + 推進 * 0.5) の計算式を実装。
                【コード現状注釈】: 未達成。パーツの`Charge`値をゲージ最大値として使用。
            [ ] b. クールダウン時間: 500 / (冷却 + 推進 * 0.5) の計算式を実装。
                【コード現状注釈】: 未達成。パーツの`Cooldown`値をゲージ最大値として使用。

        [ ] 2. 命中/回避/クリティカル計算:
            【コード現状注釈】: `action_trait`の扱いが異なり、クリティカル計算は未実装。

            [ ] a. action_traitの読み取り: 選択したパーツのaction_traitを読み取る。
                【コード現状注釈】: 未達成。コードは簡略化された `ActionType` ("shoot", "fight", "other") を使用。
            [ ] b. 技・特性補正の適用: action_traitに応じて、狙い撃ち(+50)や殴る(+20)などの補正値を決定する。
                【コード現状注釈】: 未達成。代わりにメダルスキルによる補正あり。
            [ ] c. 最終計算値: 75 + 命中 - 機動 + 技補正 の計算式を実装。
                【コード現状注釈】: 一部達成。`75 + (Accuracy + MedalSkill*2) - Mobility` で計算。技補正なし。
            [ ] d. 判定ロジック: 最終計算値に基づき、「回避」「命中」「命中確定＆クリティカル」の3パターンに分岐させる。
                【コード現状注釈】: 未達成。回避・命中のみ。クリティカル判定なし。

        [ ] 3. ダメージ計算:
            【コード現状注釈】: `action_trait`関連のボーナス、クリティカル補正未実装。耐久計算、最低保証ダメージも仕様と異なる。

            [ ] a. 我武者羅の威力ボーナス: action_traitがBERSERKの場合、脚部の推進パラメータを威力に加算する。
                【コード現状注釈】: 未達成。BERSERK特性なし。
            [ ] b. 威力 - 耐久: (威力 - (被弾パーツ耐久 + 脚部耐久)) の計算式を実装。
                【コード現状注釈】: 未達成。`(Power + MedalSkill*3) - 被弾パーツDefenseParam` で計算。脚部耐久は考慮外。
            [ ] c. クリティカル補正: クリティカル時にダメージを2倍にする。
                【コード現状注釈】: 未達成。クリティカル判定なし。
            [ ] d. 最低保証ダメージ: 最終ダメージが1未満の場合、1に切り上げる。
                【コード現状注釈】: 未達成。最低保証は5。

    [ ] 行動の制約 (Action Traits)
        【コード現状注釈】: 詳細な`action_trait`と関連する制約は未実装。

        [ ] 1. 制約の適用: action_traitがAIM, STRIKE, BERSERKのいずれかの場合、対応する制約を機体に付与する。
            【コード現状注釈】: 未達成。
        [ ] 2. 「回避不能」の実装: 制約中、命中計算で自身の「機動」を0として扱う。
            【コード現状注釈】: 未達成。
        [ ] 3. 「防御不能」の実装: 制約中、ダメージ計算で自身の「耐久」を0として扱う。
            【コード現状注釈】: 未達成。

【優先度：中】ゲームループの形成

1回の戦闘を「ゲーム」として成立させるための流れ。

    [ ] 戦闘シーケンス (Battle Sequence)

        [ ] 1. 戦闘開始処理:

            [ ] a. メンバー配置: 味方・敵をフィールドに配置。
                【コード現状注釈】: 実装済み。
            [ ] b. 初期行動選択: プレイヤーが3機分の行動を予約できるUIとロジック。
                【コード現状注釈】: 未達成。機体ごとの個別選択。初期一括予約なし。

        [ ] 2. タイムライン管理:

            [ ] a. ゲージ進行: 各機体のチャージ/クールダウンゲージを時間経過で進める。
                【コード現状注釈】: 実装済み。
            [ ] b. 行動実行: チャージ完了した機体から順に行動を実行させる。
                【コード現状注釈】: 実装済み。

        [ ] 3. 勝利/敗北判定:
            【コード現状注釈】: 仕様と判定条件が異なる。

            [ ] a. 勝利条件: 敵リーダー機の頭部装甲が0になったかを監視。
                【コード現状注釈】: 未達成。敵チーム全滅で勝利。
            [ ] b. 敗北条件: 味方リーダー機の頭部装甲が0になったかを監視。
                【コード現状注釈】: 未達成。自チーム全滅で敗北。

    [ ] 報酬と再挑戦 (Rewards & Retry)
        【コード現状注釈】: 未実装。

        [ ] 1. 勝利時リザルト:

            [ ] a. 熟練度加算: （まずは固定値でOK）参加メダルに熟練度を加算する。
                【コード現状注釈】: 未達成。
            [ ] b. パーツドロップ: 敵の装備パーツから、drop_rateに基づきランダムでドロップさせる。
                【コード現状注釈】: 未達成。

        [ ] 2. 敗北時処理:

            [ ] a. ペナルティなし: 敗北時のデメリットは無しとする。
                【コード現状注釈】: 現状ペナルティはないため、達成とみなせる。
            [ ] b. 再挑戦: 「再挑戦」オプションを選択すると、戦闘がリスタートする。
                【コード現状注釈】: 未達成。

【優先度：低】追加・拡張要素

コアシステムが完成した後に着手する要素。

    [ ] AIの高度化

        [ ] 1. 性格（ターゲッティング）: medals.csvのpersonalityに基づき、狙う相手を変えるロジック。
            【コード現状注釈】: 未達成。AIターゲットはランダム。`personality_jp` はCSVに存在するが未使用。

    [ ] 情報表示 (UI/UX)

        [ ] 1. リーダー機識別: 「索敵」や「頭部ヒット」でリーダー機を判明させるロジックと表示。
            【コード現状注釈】: 一部達成。リーダー機は初期表示されるが、戦闘中判明ロジックはなし。

    [ ] メダルシステムの詳細化

        [ ] 1. 相性・熟練度ボーナス: メダルの性能を戦闘計算式に反映させる（威力ボーナスなど）。
            【コード現状注釈】: 一部達成。メダルスキルが命中・威力に影響するが、仕様書外の要素。相性・熟練度ボーナスはなし。
        [ ] 2. セーブデータ連携: プレイヤーごとのメダルのレベルや熟練度をセーブ/ロードする機能。
            【コード現状注釈】: 未達成。